<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>External Authorization for Your Web Apps - SpiderSoft</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Secure your web applications without building login forms. Learn the external authorization pattern using reverse proxies (Caddy, Nginx, Traefik) to manage sessions and inject trusted user headers into your backend."><meta property="og:url" content="https://www.spidersoft.com.au/posts/2026-02-13-external-auth/"><meta property="og:site_name" content="SpiderSoft"><meta property="og:title" content="External Authorization for Your Web Apps"><meta property="og:description" content="Secure your web applications without building login forms. Learn the external authorization pattern using reverse proxies (Caddy, Nginx, Traefik) to manage sessions and inject trusted user headers into your backend."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-13T10:00:00+02:00"><meta property="article:modified_time" content="2026-02-13T10:00:00+02:00"><meta itemprop=name content="External Authorization for Your Web Apps"><meta itemprop=description content="Secure your web applications without building login forms. Learn the external authorization pattern using reverse proxies (Caddy, Nginx, Traefik) to manage sessions and inject trusted user headers into your backend."><meta itemprop=datePublished content="2026-02-13T10:00:00+02:00"><meta itemprop=dateModified content="2026-02-13T10:00:00+02:00"><meta itemprop=wordCount content="1533"><meta itemprop=keywords content="DevOps"><meta name=twitter:card content="summary"><meta name=twitter:title content="External Authorization for Your Web Apps"><meta name=twitter:description content="Secure your web applications without building login forms. Learn the external authorization pattern using reverse proxies (Caddy, Nginx, Traefik) to manage sessions and inject trusted user headers into your backend."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-B2WJVSLMP7"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-B2WJVSLMP7")}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title=SpiderSoft rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/images/logo-sq-trans-250.png alt="SpiderSoft logo"></div><div class="logo__item logo__text"><div class=logo__title>SpiderSoft</div><div class=logo__tagline>Software development</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About Us</span></a></li><li class=menu__item><a class=menu__link href=/projects/><span class=menu__text>Projects</span></a></li><li class=menu__item><a class=menu__link href=/categories/case-studies/><span class=menu__text>Case studies</span></a></li><li class=menu__item><a class=menu__link href=/services/><span class=menu__text>Agencies</span></a></li><li class=menu__item><a class=menu__link href=/contact-us/><span class=menu__text>Contact</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>External Authorization for Your Web Apps</h1><p class=post__lead>Eliminate custom login code by offloading authentication to a reverse proxy that passes trusted identity headers directly to your Go or PHP apps.</p><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2026-02-13T10:00:00+02:00>2026-02-13</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/devops/ rel=category>DevOps</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#the-core-idea>The Core Idea</a></li><li><a href=#the-headers-youll-work-with>The Headers You&rsquo;ll Work With</a></li><li><a href=#authelia-the-lightweight-contender>Authelia: The Lightweight Contender</a><ul><li><a href=#caddy--authelia-configuration>Caddy + Authelia Configuration</a></li></ul></li><li><a href=#authentik-the-feature-rich-alternative>Authentik: The Feature-Rich Alternative</a></li><li><a href=#nginx--vouch-proxy-the-diy-approach>Nginx + Vouch Proxy: The DIY Approach</a></li><li><a href=#reading-trusted-headers-in-go>Reading Trusted Headers in Go</a></li><li><a href=#reading-trusted-headers-in-php>Reading Trusted Headers in PHP</a><ul><li><a href=#simple-procedural-approach>Simple Procedural Approach</a></li><li><a href=#laravel-middleware>Laravel Middleware</a></li></ul></li><li><a href=#security-the-part-you-cant-skip>Security: The Part You Can&rsquo;t Skip</a></li><li><a href=#when-to-use-trusted-headers-vs-oidc>When to Use Trusted Headers vs. OIDC</a></li></ul></nav></div></div><div class="content post__content clearfix"><p>You&rsquo;ve got a Go API. Or a PHP app. Or both. And you need to protect them. The instinct is to reach for a library, bolt on JWT handling, wire up a database for sessions, and build yet another login form. But there&rsquo;s a better way — one that separates authentication from your application entirely.</p><p>External authorization systems sit in front of your app, handle the messy parts (login flows, MFA, session management), and pass you clean, trusted headers with user information. Your app just reads them. That&rsquo;s it.</p><p>Let&rsquo;s walk through how this works, what tools are available, and how to actually implement it in Go and PHP.</p><h2 id=the-core-idea>The Core Idea</h2><p>The pattern is straightforward. A reverse proxy (Caddy, Nginx, Traefik) receives every incoming request. Before forwarding it to your application, it asks an external authorization service: &ldquo;Is this user allowed in?&rdquo;</p><p>If the answer is yes, the auth service responds with HTTP headers containing user details — username, email, groups. The proxy injects those headers into the request and forwards it to your backend. If the answer is no, the user gets redirected to a login page.</p><p>Your application never sees unauthenticated traffic. It never manages passwords. It just reads headers.</p><pre tabindex=0><code>Client → Reverse Proxy → Auth Service (Authelia, Authentik, etc.)
                ↓                      ↓
           (if 200 OK)          (if 401/302)
                ↓                      ↓
         Your App (with          Login Portal
         trusted headers)
</code></pre><h2 id=the-headers-youll-work-with>The Headers You&rsquo;ll Work With</h2><p>Regardless of which authorization system you choose, the headers follow a common convention:</p><table><thead><tr><th>Header</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>Remote-User</code></td><td>Username or unique identifier</td><td><code>john</code></td></tr><tr><td><code>Remote-Email</code></td><td>User&rsquo;s email address</td><td><code>john@example.com</code></td></tr><tr><td><code>Remote-Name</code></td><td>Display name</td><td><code>John Doe</code></td></tr><tr><td><code>Remote-Groups</code></td><td>Comma-separated group list</td><td><code>admins,developers</code></td></tr></tbody></table><p>Some systems add extra headers or use slightly different names, but this is the baseline you can expect.</p><h2 id=authelia-the-lightweight-contender>Authelia: The Lightweight Contender</h2><p><a href=https://www.authelia.com/>Authelia</a>
is an open-source authentication and authorization server written in Go. It&rsquo;s tiny — under 20 MB compressed, under 30 MB of RAM in use — and fast. It supports TOTP, WebAuthn, push notifications, and full OpenID Connect 1.0.</p><p>For trusted header SSO, Authelia works as a forward-auth companion to your reverse proxy. Here&rsquo;s a minimal Caddy setup:</p><h3 id=caddy--authelia-configuration>Caddy + Authelia Configuration</h3><pre tabindex=0><code>app.example.com {
    forward_auth authelia:9091 {
        uri /api/authz/forward-auth
        copy_headers Remote-User Remote-Groups Remote-Email Remote-Name
    }
    reverse_proxy your-app:8080
}
</code></pre><p>Caddy sends every request to Authelia&rsquo;s <code>/api/authz/forward-auth</code> endpoint first. If the user is authenticated, Authelia returns 200 with the identity headers. Caddy copies those headers and passes them to your backend. If not, the user gets redirected to the Authelia login portal.</p><p>The Authelia side needs a matching configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># authelia configuration.yml (relevant parts)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>access_control</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>default_policy</span>: <span style=color:#ae81ff>two_factor</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>domain</span>: <span style=color:#ae81ff>app.example.com</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>policy</span>: <span style=color:#ae81ff>two_factor</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>subject</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;group:developers&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>session</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>cookies</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>domain</span>: <span style=color:#ae81ff>example.com</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>authelia_url</span>: <span style=color:#ae81ff>https://auth.example.com</span>
</span></span></code></pre></div><h2 id=authentik-the-feature-rich-alternative>Authentik: The Feature-Rich Alternative</h2><p><a href=https://goauthentik.io/>Authentik</a>
is a more full-featured identity provider. It comes with a proper admin UI, user management, LDAP integration, and support for SAML and OAuth in addition to forward-auth proxy mode. It&rsquo;s heavier than Authelia but gives you more out of the box if you need it.</p><p>The proxy integration works the same way. You configure your reverse proxy to check with Authentik before forwarding requests, and Authentik returns the same style of trusted headers.</p><p>With Caddy, the setup looks similar:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-JSON data-lang=JSON><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>app.example.com</span> {
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>forward_auth</span> <span style=color:#960050;background-color:#1e0010>authentik-server:9000</span> <span style=color:#960050;background-color:#1e0010>{</span>
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>uri</span> <span style=color:#960050;background-color:#1e0010>/outpost.goauthentik.io/auth/caddy</span>
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>copy_headers</span> <span style=color:#960050;background-color:#1e0010>X-Authentik-Username</span> <span style=color:#960050;background-color:#1e0010>X-Authentik-Groups</span> <span style=color:#960050;background-color:#1e0010>X-Authentik-Email</span> <span style=color:#960050;background-color:#1e0010>X-Authentik-Name</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>reverse_proxy</span> <span style=color:#960050;background-color:#1e0010>your-app:</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><p>Note the different header names — Authentik prefixes everything with <code>X-Authentik-</code>. Your backend code needs to account for whichever system you&rsquo;re running.</p><h2 id=nginx--vouch-proxy-the-diy-approach>Nginx + Vouch Proxy: The DIY Approach</h2><p>If you&rsquo;re on Nginx and don&rsquo;t want to commit to a full identity provider,
<a href=https://github.com/vouch/vouch-proxy>Vouch Proxy</a>
is a lightweight option. It delegates authentication to any OAuth/OIDC provider (Google, GitHub, Keycloak) and passes the result back via headers.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>app.example.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Auth subrequest
</span></span></span><span style=display:flex><span>    <span style=color:#f92672>auth_request</span> <span style=color:#e6db74>/validate</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>auth_request_set</span> $auth_user $upstream_http_x_vouch_user;
</span></span><span style=display:flex><span>    <span style=color:#f92672>auth_request_set</span> $auth_email $upstream_http_x_vouch_idp_claims_email;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Forward to backend with user info
</span></span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Remote-User</span> $auth_user;
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Remote-Email</span> $auth_email;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> = <span style=color:#e6db74>/validate</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>internal</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://vouch:9090/validate</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass_request_body</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Content-Length</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://your-app:8080</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This gives you the same end result. Your app gets headers; it doesn&rsquo;t care where they came from.</p><h2 id=reading-trusted-headers-in-go>Reading Trusted Headers in Go</h2><p>Here&rsquo;s a practical middleware for a Go application. It extracts user information from trusted headers and makes it available through the request context.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>auth</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Username</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Email</span>    <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>     <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Groups</span>   []<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>contextKey</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userContextKey</span> <span style=color:#a6e22e>contextKey</span> = <span style=color:#e6db74>&#34;auth_user&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// TrustedHeaderAuth is middleware that reads identity headers</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// set by a reverse proxy (Authelia, Authentik, etc.)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TrustedHeaderAuth</span>(<span style=color:#a6e22e>next</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span>) <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandlerFunc</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>username</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Remote-User&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>username</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Unauthorized&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusUnauthorized</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Username</span>: <span style=color:#a6e22e>username</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Email</span>:    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Remote-Email&#34;</span>),
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Name</span>:     <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Remote-Name&#34;</span>),
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>groups</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Remote-Groups&#34;</span>); <span style=color:#a6e22e>groups</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Groups</span> = <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Split</span>(<span style=color:#a6e22e>groups</span>, <span style=color:#e6db74>&#34;,&#34;</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithValue</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Context</span>(), <span style=color:#a6e22e>userContextKey</span>, <span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>next</span>.<span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>WithContext</span>(<span style=color:#a6e22e>ctx</span>))
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// UserFromContext retrieves the authenticated user from the request context.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>UserFromContext</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Value</span>(<span style=color:#a6e22e>userContextKey</span>).(<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>user</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// RequireGroup returns middleware that checks group membership.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>RequireGroup</span>(<span style=color:#a6e22e>group</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span>) <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>next</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span>) <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandlerFunc</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>UserFromContext</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Context</span>())
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Unauthorized&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusUnauthorized</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>g</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Groups</span> {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>TrimSpace</span>(<span style=color:#a6e22e>g</span>) <span style=color:#f92672>==</span> <span style=color:#a6e22e>group</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>next</span>.<span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Forbidden&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusForbidden</span>)
</span></span><span style=display:flex><span>		})
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Usage is clean:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mux</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewServeMux</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Public health check (no auth needed, proxy should bypass this)</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/health&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;ok&#34;</span>))
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Protected routes</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>protected</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewServeMux</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>protected</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/dashboard&#34;</span>, <span style=color:#a6e22e>dashboardHandler</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>protected</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/profile&#34;</span>, <span style=color:#a6e22e>profileHandler</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Admin-only routes</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>admin</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewServeMux</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/admin/users&#34;</span>, <span style=color:#a6e22e>usersHandler</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>Handle</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>TrustedHeaderAuth</span>(<span style=color:#a6e22e>protected</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>Handle</span>(<span style=color:#e6db74>&#34;/admin/&#34;</span>, <span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>TrustedHeaderAuth</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>RequireGroup</span>(<span style=color:#e6db74>&#34;admins&#34;</span>)(<span style=color:#a6e22e>admin</span>),
</span></span><span style=display:flex><span>	))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Listen only on localhost — proxy handles external traffic</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;127.0.0.1:8080&#34;</span>, <span style=color:#a6e22e>mux</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>dashboardHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>UserFromContext</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Context</span>())
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Hello, %s (%s)&#34;</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Email</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=reading-trusted-headers-in-php>Reading Trusted Headers in PHP</h2><p>The same pattern in PHP. Headers arrive as <code>$_SERVER</code> variables with an <code>HTTP_</code> prefix and dashes converted to underscores.</p><h3 id=simple-procedural-approach>Simple Procedural Approach</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getAuthUser</span>()<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $username <span style=color:#f92672>=</span> $_SERVER[<span style=color:#e6db74>&#39;HTTP_REMOTE_USER&#39;</span>] <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>empty</span>($username)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;username&#39;</span> <span style=color:#f92672>=&gt;</span> $username,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;email&#39;</span>    <span style=color:#f92672>=&gt;</span> $_SERVER[<span style=color:#e6db74>&#39;HTTP_REMOTE_EMAIL&#39;</span>] <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;name&#39;</span>     <span style=color:#f92672>=&gt;</span> $_SERVER[<span style=color:#e6db74>&#39;HTTP_REMOTE_NAME&#39;</span>] <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;groups&#39;</span>   <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>array_filter</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>array_map</span>(<span style=color:#e6db74>&#39;trim&#39;</span>, <span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#39;,&#39;</span>, $_SERVER[<span style=color:#e6db74>&#39;HTTP_REMOTE_GROUPS&#39;</span>] <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;&#39;</span>))
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>requireAuth</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $user <span style=color:#f92672>=</span> <span style=color:#a6e22e>getAuthUser</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($user <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>http_response_code</span>(<span style=color:#ae81ff>401</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Unauthorized&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $user;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>requireGroup</span>(<span style=color:#a6e22e>string</span> $group)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $user <span style=color:#f92672>=</span> <span style=color:#a6e22e>requireAuth</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>($group, $user[<span style=color:#e6db74>&#39;groups&#39;</span>], <span style=color:#66d9ef>true</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>http_response_code</span>(<span style=color:#ae81ff>403</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Forbidden&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $user;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Usage
</span></span></span><span style=display:flex><span>$user <span style=color:#f92672>=</span> <span style=color:#a6e22e>requireAuth</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Welcome, </span><span style=color:#e6db74>{</span>$user[<span style=color:#e6db74>&#39;name&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>;
</span></span></code></pre></div><h3 id=laravel-middleware>Laravel Middleware</h3><p>If you&rsquo;re running Laravel, a proper middleware keeps things tidy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Http\Middleware</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Closure</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Illuminate\Http\Request</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TrustedHeaderAuth</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handle</span>(<span style=color:#a6e22e>Request</span> $request, <span style=color:#a6e22e>Closure</span> $next, <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $requiredGroup <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $username <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Remote-User&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>empty</span>($username)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>abort</span>(<span style=color:#ae81ff>401</span>, <span style=color:#e6db74>&#39;Unauthorized&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $groups <span style=color:#f92672>=</span> <span style=color:#a6e22e>array_filter</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>array_map</span>(<span style=color:#e6db74>&#39;trim&#39;</span>, <span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#39;,&#39;</span>, $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Remote-Groups&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)))
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($requiredGroup <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>($requiredGroup, $groups, <span style=color:#66d9ef>true</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>abort</span>(<span style=color:#ae81ff>403</span>, <span style=color:#e6db74>&#39;Forbidden&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Make user info available throughout the request
</span></span></span><span style=display:flex><span>        $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>merge</span>([
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;auth_user&#39;</span> <span style=color:#f92672>=&gt;</span> [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;username&#39;</span> <span style=color:#f92672>=&gt;</span> $username,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;email&#39;</span>    <span style=color:#f92672>=&gt;</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Remote-Email&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;name&#39;</span>     <span style=color:#f92672>=&gt;</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Remote-Name&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;groups&#39;</span>   <span style=color:#f92672>=&gt;</span> $groups,
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $next($request);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Register it in your kernel and use it in routes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// routes/web.php
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>Route</span><span style=color:#f92672>::</span><span style=color:#a6e22e>middleware</span>(<span style=color:#e6db74>&#39;trusted-header-auth&#39;</span>)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>group</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Route</span><span style=color:#f92672>::</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/dashboard&#39;</span>, [<span style=color:#a6e22e>DashboardController</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, <span style=color:#e6db74>&#39;index&#39;</span>]);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Route</span><span style=color:#f92672>::</span><span style=color:#a6e22e>middleware</span>(<span style=color:#e6db74>&#39;trusted-header-auth:admins&#39;</span>)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>group</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Route</span><span style=color:#f92672>::</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/admin&#39;</span>, [<span style=color:#a6e22e>AdminController</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, <span style=color:#e6db74>&#39;index&#39;</span>]);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h2 id=security-the-part-you-cant-skip>Security: The Part You Can&rsquo;t Skip</h2><p>Trusted headers are powerful precisely because they&rsquo;re simple. But that simplicity is also a risk. If anyone can reach your app directly — bypassing the proxy — they can forge any header they want. There&rsquo;s no signature, no token, no verification. The trust is entirely based on network topology.</p><p>Here&rsquo;s what you need to get right:</p><p><strong>Never expose your app to the internet directly.</strong> Bind to <code>127.0.0.1</code> or an internal Docker network. If you&rsquo;re using Docker, don&rsquo;t publish ports — let only the reverse proxy reach the container.</p><p><strong>Lock down the source.</strong> If you can&rsquo;t fully isolate the network, validate the connecting IP. Only accept trusted headers from your proxy&rsquo;s IP address.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Go: Validate source IP before trusting headers</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TrustedProxyOnly</span>(<span style=color:#a6e22e>proxyIP</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>next</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span>) <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandlerFunc</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>host</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>SplitHostPort</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RemoteAddr</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>host</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>proxyIP</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Forbidden&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusForbidden</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>next</span>.<span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Strip incoming headers at the proxy level.</strong> Make sure your reverse proxy removes any <code>Remote-User</code>, <code>Remote-Email</code>, etc. headers from the original client request before adding the ones from the auth service. Caddy&rsquo;s <code>forward_auth</code> does this automatically. Nginx and Traefik need explicit configuration.</p><h2 id=when-to-use-trusted-headers-vs-oidc>When to Use Trusted Headers vs. OIDC</h2><p>Trusted headers are ideal when your app sits behind a single reverse proxy and doesn&rsquo;t need to make authenticated calls to other services. It&rsquo;s the simplest integration possible — no libraries, no token management, no refresh flows.</p><p>Go with OpenID Connect when your app needs to work across multiple domains, when you&rsquo;re building a public-facing SaaS, or when the app itself needs to act on behalf of the user (calling third-party APIs with delegated tokens, for example). Both Authelia and Authentik support OIDC, so you can always upgrade later without changing your auth provider.</p><p>For most self-hosted setups and internal tools, trusted headers are the pragmatic choice. Start there. Add complexity only when you actually need it.</p></div></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/2025-12-17-mikrotik-failover/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>MikroTik Dual WAN Failover & Policy-Based Routing</p></a></div></nav><section class=comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//spidersoft.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><aside class="sidebar sidebar--left"><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://duckduckgo.com/><label><input class=widget-search__field type=search placeholder=Search… name=q aria-label=Search…>
</label><input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sites value=https://www.spidersoft.com.au/></form></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/blog/>Blog</a></li><li class=widget__item><a class=widget__link href=/categories/case-studies/>Case Studies</a></li><li class=widget__item><a class=widget__link href=/categories/continuous-integration/>Continuous Integration</a></li><li class=widget__item><a class=widget__link href=/categories/devops/>DevOps</a></li><li class=widget__item><a class=widget__link href=/categories/go-lang/>Go Lang</a></li><li class=widget__item><a class=widget__link href=/categories/javascript/>JavaScript</a></li><li class=widget__item><a class=widget__link href=/categories/mac/>Mac</a></li><li class=widget__item><a class=widget__link href=/categories/open-source/>Open Source</a></li><li class=widget__item><a class=widget__link href=/categories/php/>PHP</a></li><li class=widget__item><a class=widget__link href=/categories/security/>Security</a></li><li class=widget__item><a class=widget__link href=/categories/software/>Software</a></li><li class=widget__item><a class=widget__link href=/categories/swift/>Swift</a></li><li class=widget__item><a class=widget__link href=/categories/technologies/>Technologies</a></li><li class=widget__item><a class=widget__link href=/categories/web-development/>Web Development</a></li></ul></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Facebook rel="noopener noreferrer" href=https://facebook.com/spidersoftau target=_blank><svg class="widget-social__link-icon icon icon-facebook" width="24" height="24" viewBox="0 0 352 352"><path d="m0 32v288c0 17.5 14.5 32 32 32h288c17.5.0 32-14.5 32-32V32c0-17.5-14.5-32-32-32H32C14.5.0.0 14.5.0 32zm320 0v288h-83V212h41.5l6-48H237v-31c0-14 3.5-23.5 23.5-23.5h26V66c-4.4-.6-19.8-1.5-37.5-1.5-36.9.0-62 22.2-62 63.5v36h-42v48h42v108H32V32z"/></svg>
<span>Facebook</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Twitter rel="noopener noreferrer" href=https://twitter.com/slavomirj target=_blank><svg class="widget-social__link-icon icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
<span>Twitter</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=LinkedIn rel="noopener noreferrer" href=https://linkedin.com/in/slawomirjasinski target=_blank><svg class="widget-social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg>
<span>LinkedIn</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/slav123 target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg>
<span>GitHub</span></a></div></div></div><div class="widget-sidemenu widget"><h4 class=widget__title>Menu</h4><nav class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=https://db.tt/ijgUW8i1>Dropbox</a></li><li class=widget__item><a class=widget__link href="https://hetzner.cloud/?ref=gJwTT1VzZwcJ">Hetzner Cloud</a></li><li class=widget__item><a class=widget__link href="http://www.namecheap.com?aff=9312">Namecheap</a></li></ul></nav></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/privacy-policy/>Privacy Policy</a> | <a class=footer__link href=/refund-policy/>Refund Policy</a> | <a class=footer__link href=/terms-and-conditions/>Term and conditions</a></div><div class=footer__copyright>&copy; 2026 SpiderSoft.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script><script async src=https://js.sitesearch360.com/plugin/bundle/2996.js></script></body></html>