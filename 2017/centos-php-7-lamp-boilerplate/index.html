<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Centos PHP 7 LAMP boilerplate - SpiderSoft</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:url" content="https://www.spidersoft.com.au/2017/centos-php-7-lamp-boilerplate/"><meta property="og:site_name" content="SpiderSoft"><meta property="og:title" content="Centos PHP 7 LAMP boilerplate"><meta property="og:description" content="This time we are going to cook Apache (httpd 2.4), PHP 7.0 as a PHP-FPM . Instructions are pretty simple. You can just copy and paste command to get working stack in less then 15 minutes.
What you can learn from it? How to install Apache 2.4 and PHP 7, how to enable and opcache, and how to install HTTPS on your server, with purchasing SSL certificate."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-09-05T03:45:48+00:00"><meta property="article:modified_time" content="2017-09-05T03:45:48+00:00"><meta property="article:tag" content="Apache"><meta property="article:tag" content="Centos"><meta property="article:tag" content="Lamp"><meta property="article:tag" content="DevOps"><meta property="article:tag" content="Php"><meta itemprop=name content="Centos PHP 7 LAMP boilerplate"><meta itemprop=description content="This time we are going to cook Apache (httpd 2.4), PHP 7.0 as a PHP-FPM . Instructions are pretty simple. You can just copy and paste command to get working stack in less then 15 minutes.
What you can learn from it? How to install Apache 2.4 and PHP 7, how to enable and opcache, and how to install HTTPS on your server, with purchasing SSL certificate."><meta itemprop=datePublished content="2017-09-05T03:45:48+00:00"><meta itemprop=dateModified content="2017-09-05T03:45:48+00:00"><meta itemprop=wordCount content="513"><meta itemprop=keywords content="Apache,Centos,Lamp,DevOps,Php"><meta name=twitter:card content="summary"><meta name=twitter:title content="Centos PHP 7 LAMP boilerplate"><meta name=twitter:description content="This time we are going to cook Apache (httpd 2.4), PHP 7.0 as a PHP-FPM . Instructions are pretty simple. You can just copy and paste command to get working stack in less then 15 minutes.
What you can learn from it? How to install Apache 2.4 and PHP 7, how to enable and opcache, and how to install HTTPS on your server, with purchasing SSL certificate."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title=SpiderSoft rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/images/logo-sq-trans-250.png alt="SpiderSoft logo"></div><div class="logo__item logo__text"><div class=logo__title>SpiderSoft</div><div class=logo__tagline>Software development</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About Us</span></a></li><li class=menu__item><a class=menu__link href=/projects/><span class=menu__text>Projects</span></a></li><li class=menu__item><a class=menu__link href=/categories/case-studies/><span class=menu__text>Case studies</span></a></li><li class=menu__item><a class=menu__link href=/services/><span class=menu__text>Agencies</span></a></li><li class=menu__item><a class=menu__link href=/resources/><span class=menu__text>Resources</span></a></li><li class=menu__item><a class=menu__link href=/contact-us/><span class=menu__text>Contact</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Centos PHP 7 LAMP boilerplate</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2017-09-05T03:45:48Z>2017-09-05</time>
<time class=meta__text datetime=2017-09-05T03:45:48Z>(Last Modified: 2017-09-05)</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/devops/ rel=category>DevOps</a>, <a class=meta__link href=/categories/php/ rel=category>PHP</a></span></div></div></header><figure class=post__thumbnail><img src=/images/2017/09/CentOSLogo_hu8270901075633787124.png alt="Centos PHP 7 LAMP boilerplate"></figure><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><ul><li><a href=#centos-7>Centos 7</a></li><li><a href=#firewall>Firewall</a></li><li><a href=#php-configuration>PHP configuration</a></li><li><a href=#server-configuration>Server configuration</a></li><li><a href=#apache-configuration>Apache configuration</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><p>This time we are going to cook Apache (httpd 2.4), PHP 7.0 as a
<a href=http://wiki.apache.org/httpd/PHP-FPM>PHP-FPM</a>
. Instructions are pretty simple. You can just copy and paste command to get working stack in less then 15 minutes.</p><p>What you can learn from it? How to install Apache 2.4 and PHP 7, how to enable and opcache, and how to install HTTPS on your server, with purchasing SSL certificate.</p><h3 id=centos-7>Centos 7</h3><ul><li>Log in to server as user,</li><li>To save some time, switch to sudo user:<br><code>sudo -i</code></li><li>we are going to need REMI repository for PHP 7<br><code>wget http://rpms.famillecollet.com/enterprise/remi-release-7.rpm rpm -Uvh remi-release-7.rpm</code></li><li>Upgrade everything to the latest versions:<br><code>yum update -y</code></li></ul><p>Let&rsquo;s start with some software:</p><pre tabindex=0><code>sudo yum install httpd mod_proxy_html php70-fpm 
sudo yum install php70-php-mcrypt php70-php-mbstring php70-php-gd php70-php-mysqli php70-php-xml hp70-php-opcache
</code></pre><p>After while…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SHELL data-lang=SHELL><span style=display:flex><span>sudo service php70-php-fpm start
</span></span><span style=display:flex><span>sudo service httpd start
</span></span><span style=display:flex><span>sudo chkconfig --levels <span style=color:#ae81ff>235</span> httpd on
</span></span><span style=display:flex><span>sudo chkconfig php-fpm on
</span></span></code></pre></div><p>Done – your LAMP stack works. But it’s not visible from outside world yet…</p><h3 id=firewall>Firewall</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SHELL data-lang=SHELL><span style=display:flex><span>firewall-cmd --permanent --add-service<span style=color:#f92672>=</span>http
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><h3 id=php-configuration>PHP configuration</h3><p>Let’s do some more configuration around PHP:<br>We have to find php.ini – <code>php70 -i | grep php.ini</code> gives us:<br>In <code>/etc/opt/remi/php70/php.ini</code> timezone should be setup like that:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SHELL data-lang=SHELL><span style=display:flex><span>date.timezone <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Australia/Sydney&#34;</span>
</span></span><span style=display:flex><span>expose_php <span style=color:#f92672>=</span> Off
</span></span></code></pre></div><p>Don’t forget to restart httpd and php-fpm to see changes</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SHELL data-lang=SHELL><span style=display:flex><span>sudo service httpd restart
</span></span><span style=display:flex><span>sudo service php-fpm restart
</span></span></code></pre></div><p>By default, PHP has very low limit on  size of uploaded files. It’s very good practice to increase it.<br>We are looking for 2 values</p><pre tabindex=0><code>upload_max_filesize=20M
post_max_size=32M
</code></pre><h3 id=server-configuration>Server configuration</h3><p>Now we have to update server to proper TimeZone</p><pre tabindex=0><code>cd /etc/
sudo rm -rf localtime &amp;&amp; sudo ln -s /usr/share/zoneinfo/Australia/Sydney localtime
</code></pre><p>Of course replace Australia/Sydney with proper Time Zone – pretty nice list is available on
<a href=http://www.php.net/manual/en/timezones.php>PHP documentation website</a>
.</p><p><a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-time.html>http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-time.html</a></p><p>Good idea is to update time on the server straight away using command</p><pre tabindex=0><code>sudo ntpdate -u pool.ntp.org
</code></pre><h3 id=apache-configuration>Apache configuration</h3><p>We have to push our PHP files from Apache to PHP-FPM deamon.<br>Create file <code>/etc/httpd/conf.d/proxy.conf</code><br>and paste there these lines</p><pre tabindex=0><code>ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9000/var/www/html/$1
</code></pre><p>If you would like to use sockets instead of TCP connection, yo ucan set it up like this:</p><pre tabindex=0><code>ProxyPassMatch ^/(.*\.php(/.*)?)$ unix:/var/run/php-sock|fcgi://localhost/var/www/html
</code></pre><p>Don’t forget enable proxy module to handle this directives:</p><pre tabindex=0><code>LoadModule proxy_fcgi_module libexec/apache2/mod_proxy_fcgi.so
</code></pre><p>Restart Apache again – sudo service httpd restart and try again using test:</p><pre tabindex=0><code>echo &#34;&lt;?php phpinfo();&#34; &gt; /var/www/html/info.php
</code></pre><p>And test it via browser: http://your-ip/info.php</p><h4 id=htaccess-support>.htaccess support</h4><p><code>sudo nano /etc/httpd/conf/httpd.conf</code></p><p>You are looking for section starting:</p><pre tabindex=0><code># Further relax access to the default document root:
&lt;Directory &#34;/var/www/html&#34;&gt;
</code></pre><p>And just change<br><code>AllowOverride None</code><br>to<br><code>AllowOverride All</code><br>to enable .htaccess<br>To disable showing up directory content update</p><pre tabindex=0><code>Options Indexes FollowSymLinks
</code></pre><p>to</p><pre tabindex=0><code>Options -Indexes 
Options -FollowSymLinks
</code></pre><h4 id=some-security-settings-don8217t-expose-apache>Some security settings (don’t expose Apache)</h4><pre tabindex=0><code>ServerTokens Prod
ServerSignature Off
</code></pre><h4 id=fontface-apache-support>Fontface Apache support</h4><pre tabindex=0><code>AddType application/vnd.ms-fontobject .eot
AddType application/x-font-ttf .ttf
AddType application/x-font-woff .woff
</code></pre><h4 id=get-some-speed-on-apache>Get some speed on Apache</h4><pre tabindex=0><code>&lt;IfModule mod_headers.c&gt;
  &lt;FilesMatch &#34;\.(js|css|xml|gz)$&#34;&gt;
    Header append Vary: Accept-Encoding
&lt;/FilesMatch&gt;
&lt;/IfModule&gt;
</code></pre><h4 id=compress-text-html-javascript-css-xml>compress text, html, javascript, css, xml:</h4><pre tabindex=0><code>AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE text/javascript
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript
</code></pre></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/apache/ rel=tag>apache</a></li><li class=tags__item><a class="tags__link btn" href=/tags/centos/ rel=tag>centos</a></li><li class=tags__item><a class="tags__link btn" href=/tags/lamp/ rel=tag>lamp</a></li><li class=tags__item><a class="tags__link btn" href=/tags/devops/ rel=tag>DevOps</a></li><li class=tags__item><a class="tags__link btn" href=/tags/php/ rel=tag>php</a></li></ul></div></footer><footer class=post__related><section><h3>See Also</h3><ul><li><a href=/2019/web-server-on-ami-linux-2/>Web Server on AMI Linux 2</a></li><li><a href=/2014/apache-and-php-on-os-x-yosemite/>Apache and PHP on OS X Yosemite</a></li><li><a href=/2014/ffmpeg-on-ami-linux-and-centos-the-easy-way/>FFmpeg on AMI Linux and CentOS the easy way</a></li><li><a href=/2014/php-5-4-x-on-centos-6-5/>PHP 5.4.x on CentOS 6.5</a></li><li><a href=/2014/centoos-7-nfs-support/>CentoOS 7 NFS support</a></li></ul></section></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/2017/swap-space-on-ec2-on-separate-volume/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>SWAP space on EC2 on separate volume</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/2017/getting-started-with-aws-cli/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Getting started with AWS CLI</p></a></div></nav><section class=comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//spidersoft.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><aside class="sidebar sidebar--left"><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://duckduckgo.com/><label><input class=widget-search__field type=search placeholder=Search… name=q aria-label=Search…>
</label><input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sites value=https://www.spidersoft.com.au/></form></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/blog/>Blog</a></li><li class=widget__item><a class=widget__link href=/categories/case-studies/>Case Studies</a></li><li class=widget__item><a class=widget__link href=/categories/continuous-integration/>Continuous Integration</a></li><li class=widget__item><a class=widget__link href=/categories/devops/>DevOps</a></li><li class=widget__item><a class=widget__link href=/categories/go-lang/>Go Lang</a></li><li class=widget__item><a class=widget__link href=/categories/javascript/>JavaScript</a></li><li class=widget__item><a class=widget__link href=/categories/mac/>Mac</a></li><li class=widget__item><a class=widget__link href=/categories/open-source/>Open Source</a></li><li class=widget__item><a class=widget__link href=/categories/php/>PHP</a></li><li class=widget__item><a class=widget__link href=/categories/software/>Software</a></li><li class=widget__item><a class=widget__link href=/categories/swift/>Swift</a></li><li class=widget__item><a class=widget__link href=/categories/technologies/>Technologies</a></li><li class=widget__item><a class=widget__link href=/categories/web-development/>Web Development</a></li></ul></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Facebook rel="noopener noreferrer" href=https://facebook.com/spidersoftau target=_blank><svg class="widget-social__link-icon icon icon-facebook" width="24" height="24" viewBox="0 0 352 352"><path d="m0 32v288c0 17.5 14.5 32 32 32h288c17.5.0 32-14.5 32-32V32c0-17.5-14.5-32-32-32H32C14.5.0.0 14.5.0 32zm320 0v288h-83V212h41.5l6-48H237v-31c0-14 3.5-23.5 23.5-23.5h26V66c-4.4-.6-19.8-1.5-37.5-1.5-36.9.0-62 22.2-62 63.5v36h-42v48h42v108H32V32z"/></svg>
<span>Facebook</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Twitter rel="noopener noreferrer" href=https://twitter.com/slavomirj target=_blank><svg class="widget-social__link-icon icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
<span>Twitter</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=LinkedIn rel="noopener noreferrer" href=https://linkedin.com/in/slawomirjasinski target=_blank><svg class="widget-social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg>
<span>LinkedIn</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/slav123 target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg>
<span>GitHub</span></a></div></div></div><div class="widget-sidemenu widget"><h4 class=widget__title>Menu</h4><nav class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=https://m.do.co/c/4d3f8f5c4118>DigitalOcean</a></li><li class=widget__item><a class=widget__link href=https://db.tt/ijgUW8i1>Dropbox</a></li><li class=widget__item><a class=widget__link href="http://www.namecheap.com?aff=9312">Namecheap</a></li></ul></nav></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/privacy-policy/>Privacy Policy</a> | <a class=footer__link href=/refund-policy/>Refund Policy</a> | <a class=footer__link href=/terms-and-conditions/>Term and conditions</a></div><div class=footer__copyright>&copy; 2024 SpiderSoft.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script><script async src=https://js.sitesearch360.com/plugin/bundle/2996.js></script></body></html>